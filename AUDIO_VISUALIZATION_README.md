# Визуализация аудио-дорожки при записи

## Обзор

Добавлена новая функциональность визуализации аудио-дорожки при записи голосовых сообщений в чате и судебных заседаниях.

## Новые компоненты

### 1. AudioVisualizer
- **Файл**: `src/components/AudioVisualizer.js`
- **Стили**: `src/components/AudioVisualizer.css`
- **Функциональность**: 
  - Анимированная визуализация аудио-волны
  - Индикатор уровня звука при записи
  - Прогресс-бар воспроизведения
  - Возможность перемотки по клику
  - Адаптивный дизайн

### 2. VoiceChatInput
- **Файл**: `src/components/VoiceChatInput.js`
- **Стили**: `src/components/VoiceChatInput.css`
- **Функциональность**:
  - Запись голосовых сообщений
  - Визуализация в реальном времени
  - Предварительное прослушивание
  - Отправка голосовых сообщений
  - Интеграция с существующим чатом

## Интеграция

### В Chat.js
- Заменен `ChatInput` на `VoiceChatInput`
- Добавлен обработчик `handleSendVoiceMessage`
- Поддержка отправки голосовых сообщений на сервер

### В CourtHearing.js
- Добавлен компонент `AudioVisualizer`
- Интеграция с существующей функциональностью записи
- Поддержка перемотки и воспроизведения

## Серверная часть

### Обновления в chatRoutes.js
- Добавлена настройка multer для обработки аудио файлов
- Новый endpoint `/api/chat/voice` для обработки голосовых сообщений
- Поддержка FormData для загрузки аудио

### Настройка multer
```javascript
const storage = multer.diskStorage({
  destination: (req, file, cb) => {
    const uploadDir = path.join(__dirname, '../uploads/audio');
    if (!fs.existsSync(uploadDir)) {
      fs.mkdirSync(uploadDir, { recursive: true });
    }
    cb(null, uploadDir);
  },
  filename: (req, file, cb) => {
    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);
    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
    cb(null, `voice-message-${timestamp}-${uniqueSuffix}${path.extname(file.originalname)}`);
  }
});
```

## Использование

### В чате
1. Нажмите кнопку микрофона для начала записи
2. Говорите в микрофон - визуализация покажет уровень звука
3. Нажмите кнопку остановки для завершения записи
4. Прослушайте запись перед отправкой
5. Нажмите кнопку отправки для передачи голосового сообщения

### В судебном заседании
1. Нажмите "Начать запись" в компоненте CourtHearing
2. Визуализация покажет процесс записи в реальном времени
3. Остановите запись и проанализируйте заседание
4. Используйте перемотку для навигации по записи

## Особенности

### Визуализация
- Анимированные бары с градиентами
- Разные цвета для записи (красный) и воспроизведения (синий)
- Плавные переходы и анимации
- Индикатор качества записи

### Адаптивность
- Поддержка мобильных устройств
- Темная тема
- Различные размеры экранов

### Производительность
- Оптимизированная отрисовка на canvas
- Эффективное управление памятью
- Очистка ресурсов при размонтировании

## Технические детали

### Поддерживаемые форматы аудио
- WAV
- MP3
- OGG
- M4A

### Ограничения
- Максимальный размер файла: 50MB
- Таймаут запроса: 30 секунд
- Автоматическая очистка временных файлов

### Безопасность
- Валидация типов файлов
- Проверка MIME типов
- Ограничение размера файлов
- Безопасные имена файлов

## Будущие улучшения

1. **Реальная визуализация аудио**: Интеграция с Web Audio API для отображения реальной частотной характеристики
2. **Распознавание речи**: Интеграция с OpenAI Whisper для транскрипции
3. **Сжатие аудио**: Оптимизация размера файлов
4. **Потоковая передача**: Поддержка потоковой передачи аудио
5. **Дополнительные эффекты**: Фильтры и эффекты для аудио

## Устранение неполадок

### Проблемы с записью
1. Проверьте разрешения микрофона в браузере
2. Убедитесь, что микрофон подключен и работает
3. Проверьте консоль браузера на наличие ошибок

### Проблемы с визуализацией
1. Убедитесь, что браузер поддерживает Canvas API
2. Проверьте, что JavaScript включен
3. Обновите браузер до последней версии

### Проблемы с сервером
1. Проверьте логи сервера
2. Убедитесь, что папка uploads/audio существует
3. Проверьте права доступа к папкам 