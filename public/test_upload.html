<!DOCTYPE html>
<html>
<head>
    <title>Тест загрузки изображений</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .upload-area { 
            border: 2px dashed #ccc; 
            padding: 20px; 
            text-align: center; 
            margin: 20px 0; 
            cursor: pointer; 
        }
        .upload-area:hover { border-color: #007bff; }
        #result { margin-top: 20px; padding: 10px; background: #f8f9fa; }
        .success { background: #d4edda !important; color: #155724; }
        .error { background: #f8d7da !important; color: #721c24; }
    </style>
</head>
<body>
    <h1>Тест загрузки изображений</h1>
    
    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
        <p>Нажмите для выбора изображения или перетащите файл сюда</p>
        <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="handleFileSelect(event)">
    </div>
    
    <div id="result"></div>
    
    <script>
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Загружаем файл: ' + file.name + '...';
            resultDiv.className = '';
            
            const formData = new FormData();
            formData.append('image', file);
            
            fetch('/api/ocr/recognize', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    resultDiv.innerHTML = `
                        <h3>✅ Успешно!</h3>
                        <p><strong>Файл:</strong> ${data.filename}</p>
                        <p><strong>Распознанный текст:</strong></p>
                        <pre>${data.text}</pre>
                    `;
                    resultDiv.className = 'success';
                } else {
                    resultDiv.innerHTML = `
                        <h3>❌ Ошибка!</h3>
                        <p>${data.error || 'Неизвестная ошибка'}</p>
                    `;
                    resultDiv.className = 'error';
                }
            })
            .catch(error => {
                resultDiv.innerHTML = `
                    <h3>❌ Ошибка сети!</h3>
                    <p>${error.message}</p>
                `;
                resultDiv.className = 'error';
            });
        }
        
        // Drag and drop
        const uploadArea = document.querySelector('.upload-area');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#007bff';
        });
        
        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ccc';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#ccc';
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                const fileInput = document.getElementById('fileInput');
                fileInput.files = files;
                handleFileSelect({ target: { files: files } });
            }
        });
    </script>
</body>
</html> 